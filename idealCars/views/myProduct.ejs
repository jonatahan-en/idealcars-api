<%- include("header.ejs") %>
<link rel="stylesheet" href="/css/styles.css">
<link rel="stylesheet" href="/css/myProduct.css">

<!-- Variable oculta para almacenar el mensaje -->
<div id="confirmMessage" style="display:none;"><%= __('myProduct.confirmDelete') %></div>

<main class="products-container">
    <h2 class="title-page">🚗 <%= __('navigation.myProducts') %></h2>

    <div class="product-grid">
        <% products.forEach(product => { %>
        <div class="product-card">
            <img class="product-image" src="<%= product.images && product.images.length > 0 ? `/imagenes/${product.images[0]}` : `https://placehold.co/300x200?text=${__('myProduct.noImageText')}` %>" alt="<%= product.name %>">
            <div class="product-info">
            <h3><%= product.name %></h3>
            <p>🔰 <%= __('home.product.model') %>: <%= product.model %></p>
            <p>🎨 <%= __('home.product.color') %>: <%= product.color %></p>
            <p>📅 <%= __('home.product.year') %>: <%= product.year %></p>
            <p>💶 <%= __('home.product.price') %>: <%= product.price?.toLocaleString('es-ES', { style: 'currency', currency: 'EUR' }) %></p>
            <p>🏁 <%= __('home.product.kilometer') %>: <%= product.kilometer?.toLocaleString('es-ES') %> km</p>
            </div>
            <div class="product-action">
            <a href="/myproducts/edit/<%= product._id %>" class="btn-edit">
                <i class="bi bi-pencil"></i> <%= __('common.edit') %>
            </a> 
            <form action="/myproducts/delete/<%= product._id %>?_method=DELETE" method="POST" class="delete-form">
                <button type="submit" class="btn-delete">
                    <i class="bi bi-trash3"></i> <%= __('common.delete') %>
                </button>
            </form>
            </div>
        </div>
        <% }) %>
    </div>
    
    <nav aria-label="Page navigation" class="d-flex justify-content-center mt-4">
        <ul class="pagination pagination-sm">
            <% if (skip > 0) { %>
                <li class="page-item">
                    <a class="page-link" href="?skip=<%= Math.max(0, skip - limit) %>&limit=<%= limit %>"><%= __('common.previous') %></a>
                </li>
            <% } else { %>
                <li class="page-item disabled">
                    <span class="page-link"><%= __('common.previous') %></span>
                </li>
            <% } %>
            
            <% const totalPages = Math.ceil(count / limit); %>
            <% const currentPage = Math.floor(skip / limit) + 1; %>
            <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
                <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                    <a class="page-link" href="?skip=<%= (i - 1) * limit %>&limit=<%= limit %>"><%= i %></a>
                </li>
            <% } %>
            
            <% if (skip + limit < count) { %>
                <li class="page-item">
                    <a class="page-link" href="?skip=<%= skip + limit %>&limit=<%= limit %>"><%= __('common.next') %></a>
                </li>
            <% } else { %>
                <li class="page-item disabled">
                    <span class="page-link"><%= __('common.next') %></span>
                </li>
            <% } %>
        </ul>
    </nav>
</main>

<script>
    // Obtener el mensaje de confirmación una vez al cargar la página
    const confirmMessage = document.getElementById('confirmMessage').textContent;
    
    // Añadir listeners a todos los formularios de eliminación
    document.addEventListener('DOMContentLoaded', function() {
        const deleteForms = document.querySelectorAll('.delete-form');
        deleteForms.forEach(form => {
            form.addEventListener('submit', function(event) {
                if (!confirm(confirmMessage)) {
                    event.preventDefault();
                }
            });
        });
    });
</script>
<%- include("footer.ejs") %>