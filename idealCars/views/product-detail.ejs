<!-- header -->
<%- include("header.ejs") %>
<link rel="stylesheet" href="/css/product-detail.css"> 
<link rel="stylesheet" href="/css/styles.css">
<main class="card-container">
    <section class="detail-card">
        <h2><%= product.brand %> <%= product.model %></h2>
        <p>🎨 <strong><%= __('home.product.color') %>:</strong> <%= product.color %></p>
        <p>📅 <strong><%= __('home.product.year') %>:</strong> <%= product.year %></p>
        <p>💶 <strong><%= __('home.product.price') %>:</strong> <%= typeof product.price !== 'undefined' ? product.price.toLocaleString('es-ES', { style: 'currency', currency: 'EUR' }) : '' %></p>
        <p>🏁 <strong><%= __('home.product.kilometer') %>:</strong> <%= typeof product.kilometer !== 'undefined' ? product.kilometer.toLocaleString('es-ES') : '' %> km</p>
        <% if (product.images && product.images.length > 0) { %>
        <div class="carousel-container" id="carousel">
            <% product.images.forEach((image) => { %>
            <img src="/<%= image.startsWith('img_cars/') ? '' : 'imagenes/' %><%= image %>" alt="<%= product.brand %> <%= product.model %>">
            <% }) %>
            <button class="carousel-btn prev" onclick="moveSlide(-1)">&#10094;</button>
            <button class="carousel-btn next" onclick="moveSlide(1)">&#10095;</button>
        </div>
        <% } else { %>
        <p><%= __('productDetail.noImages') %></p>
        <% } %>
        <div class="button-group">
        <a href="/chat/<%= product._id %>" class="btn action-btn">💬 <%= __('productDetail.goToChat') %></a>
        <form action="/email" method="get" class="email-form">
            <input type="hidden" name="productId" value="<%= product._id %>">
            <button type="submit" class="btn action-btn">📩 <%= __('common.email') %></button>
        </form>
        </div>
        <div class="home-container">
            <a href="/" class="btn home-btn">🏠 <%= __('common.home') %></a>
        </div>
    </section>
</main>

<script>
// Variable para el índice actual
let currentIndex = 0;

// Función para mover los slides
function moveSlide(direction) {
    const slides = document.querySelectorAll('#carousel img');
    if (slides.length <= 1) return; // No hacer nada si hay 0 o 1 imágenes
    
    const totalSlides = slides.length;
    
    // Ocultar la slide actual
    slides[currentIndex].style.display = 'none';
    
    // Calcular el nuevo índice (con manejo circular)
    currentIndex = (currentIndex + direction + totalSlides) % totalSlides;
    
    // Mostrar la nueva slide
    slides[currentIndex].style.display = 'block';
    
    console.log(`Mostrando imagen ${currentIndex+1} de ${totalSlides}`);
}

// Inicializar el carrusel cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', () => {
    const slides = document.querySelectorAll('#carousel img');
    console.log(`Carrusel inicializado con ${slides.length} imágenes`);
    
    if (slides.length > 0) {
        // Ocultar todas las imágenes inicialmente
        slides.forEach(slide => slide.style.display = 'none');
        
        // Mostrar solo la primera imagen
        slides[0].style.display = 'block';
        
        // Si solo hay una imagen, ocultar los botones de navegación
        if (slides.length <= 1) {
            const prevBtn = document.querySelector('.carousel-btn.prev');
            const nextBtn = document.querySelector('.carousel-btn.next');
            if (prevBtn) prevBtn.style.display = 'none';
            if (nextBtn) nextBtn.style.display = 'none';
        }
    }
});
</script>
<%- include("footer.ejs") %>
